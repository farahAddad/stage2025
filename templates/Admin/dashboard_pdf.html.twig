<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Formations - Rapport PDF</title>
    <style>
        @page {
            margin: 2cm;
            size: A4;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
            margin: 0;
            padding: 0;
        }
        
        /* Supprimer les ic√¥nes automatiques de Bootstrap */
        abbr[title]::after,
        abbr[data-original-title]::after {
            content: none !important;
        }
        
        /* S'assurer que le titre s'affiche correctement */
        .main-title {
            color: #007bff;
            font-size: 28px;
            margin: 0 0 10px 0;
            font-weight: bold;
            text-decoration: none;
        }
        
        .main-title::before,
        .main-title::after {
            content: none !important;
        }
        
        .header {
            text-align: center;
            border-bottom: 3px solid #007bff;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .header .subtitle {
            color: #666;
            font-size: 16px;
            margin: 0;
        }
        
        .header .date {
            color: #999;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        
        .section-title {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 8px;
        }
        
        .stat-card .label {
            font-size: 14px;
            color: #666;
            font-weight: 600;
        }
        
        .stat-card .trend {
            font-size: 12px;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }
        
        .trend.positive {
            background: #d4edda;
            color: #155724;
        }
        
        .trend.negative {
            background: #f8d7da;
            color: #721c24;
        }
        
        .trend.neutral {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .table-container {
            margin: 20px 0;
        }
        
        .table-title {
            color: #495057;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid #007bff;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        /* Supprimer les points d'interrogation des titres de tableaux */
        .table-title::before,
        .table-title::after {
            content: none !important;
        }
        
        /* Supprimer tous les points d'interrogation automatiques */
        h3::before,
        h3::after,
        .table-title::before,
        .table-title::after {
            content: none !important;
        }
        
        /* R√®gles CSS ultra-agressives pour supprimer TOUT contenu automatique */
        *::before,
        *::after {
            content: none !important;
        }
        
        /* Supprimer sp√©cifiquement les ic√¥nes d'aide et de question */
        abbr::after,
        abbr::before,
        [title]::after,
        [title]::before,
        [data-original-title]::after,
        [data-original-title]::before {
            content: none !important;
        }
        
        /* Forcer l'affichage sans ic√¥nes */
        .table-title {
            content: none !important;
        }
        
        .table-title *::before,
        .table-title *::after {
            content: none !important;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: bold;
            font-size: 13px;
        }
        
        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #dee2e6;
            font-size: 12px;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .data-table tr:hover {
            background-color: #e9ecef;
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .progress-fill.excellent { background: linear-gradient(90deg, #28a745, #20c997); }
        .progress-fill.good { background: linear-gradient(90deg, #ffc107, #fd7e14); }
        .progress-fill.poor { background: linear-gradient(90deg, #dc3545, #e83e8c); }
        
        .highlight-box {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .highlight-box h3 {
            color: #856404;
            margin: 0 0 15px 0;
            font-size: 20px;
        }
        
        .highlight-box .highlight-value {
            font-size: 36px;
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
        }
        
        .highlight-box .highlight-description {
            color: #856404;
            font-size: 14px;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #dee2e6;
            text-align: center;
            color: #666;
            font-size: 12px;
        }
        
        .page-break {
            page-break-before: always;
        }
        
        .chart-placeholder {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            color: #666;
            margin: 20px 0;
        }
        
        .chart-placeholder h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #dee2e6;
            text-align: center;
            color: #666;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- En-t√™te -->
    <div class="header">
        <div class="main-title">üìä Dashboard des Formations</div>
        <p class="subtitle">Rapport d'analyse et de statistiques</p>
        <p class="date">G√©n√©r√© le {{ dateExport|date('d/m/Y √† H:i') }}</p>
    </div>

    <!-- Section 1: Vue d'ensemble -->
    <div class="section">
        <h2 class="section-title">üéØ Vue d'ensemble</h2>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="value">{{ globalStats.totalFormations }}</div>
                <div class="label">Total Formations</div>
            </div>
            
            <div class="stat-card">
                <div class="value">{{ globalStats.joursFormation }}</div>
                <div class="label">Total Jours Formation</div>
            </div>
            
            <div class="stat-card">
                <div class="value">{{ globalStats.tauxParticipation }}%</div>
                <div class="label">Taux de Participation</div>
                <div class="trend {% if globalStats.tauxParticipation >= 70 %}positive{% elseif globalStats.tauxParticipation >= 40 %}neutral{% else %}negative{% endif %}">
                    {% if globalStats.tauxParticipation >= 70 %}Excellent{% elseif globalStats.tauxParticipation >= 40 %}Bon{% else %}√Ä am√©liorer{% endif %}
                </div>
            </div>
            
            <div class="stat-card">
                <div class="value">{{ globalStats.tauxSatisfaction }}/5</div>
                <div class="label">Satisfaction Moyenne</div>
                <div class="trend {% if globalStats.tauxSatisfaction >= 4 %}positive{% elseif globalStats.tauxSatisfaction >= 3 %}neutral{% else %}negative{% endif %}">
                    {% if globalStats.tauxSatisfaction >= 4 %}Excellent{% elseif globalStats.tauxSatisfaction >= 3 %}Bon{% else %}√Ä am√©liorer{% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Section 2: Statistiques avanc√©es -->
    <div class="section">
        <h2 class="section-title">üìà Statistiques avanc√©es</h2>
        
        <div class="highlight-box">
            <h3>üèÜ Mois le plus actif</h3>
            <div class="highlight-value">
                {% if calculsAvances.moisPlusActif and calculsAvances.moisPlusActif.month %}
                    {{ calculsAvances.moisPlusActif.month }}
                {% else %}
                    Aucun
                {% endif %}
            </div>
            <div class="highlight-description">
                {% if calculsAvances.moisPlusActif and calculsAvances.moisPlusActif.formations %}
                    {{ calculsAvances.moisPlusActif.formations }} formations cr√©√©es
                {% else %}
                    Aucune formation
                {% endif %}
            </div>
        </div>
        
        <!-- D√©tails du mois le plus actif -->
        {% if calculsAvances.moisPlusActif and calculsAvances.moisPlusActif.month != 'Aucun' %}
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="value">{{ calculsAvances.moisPlusActif.formations }}</div>
                    <div class="label">Formations cr√©√©es</div>
                </div>
                
                <div class="stat-card">
                    <div class="value">{{ calculsAvances.moisPlusActif.sessions }}</div>
                    <div class="label">Sessions organis√©es</div>
                </div>
                
                <div class="stat-card">
                    <div class="value">{{ calculsAvances.moisPlusActif.participants }}</div>
                    <div class="label">Total participants</div>
                </div>
                
                <div class="stat-card">
                    <div class="value">{{ calculsAvances.moisPlusActif.inscriptionsAcceptees }}</div>
                    <div class="label">Inscriptions accept√©es</div>
                </div>
                
                <div class="stat-card">
                    <div class="value">{{ calculsAvances.moisPlusActif.moyenneSatisfaction }}/5</div>
                    <div class="label">Satisfaction moyenne</div>
                    <div class="trend {% if calculsAvances.moisPlusActif.moyenneSatisfaction >= 4 %}positive{% elseif calculsAvances.moisPlusActif.moyenneSatisfaction >= 3 %}neutral{% else %}negative{% endif %}">
                        {% if calculsAvances.moisPlusActif.moyenneSatisfaction >= 4 %}Excellent{% elseif calculsAvances.moisPlusActif.moyenneSatisfaction >= 3 %}Bon{% else %}√Ä am√©liorer{% endif %}
                    </div>
                </div>
            </div>
        {% endif %}
        

    </div>



    <!-- Section 4: R√©partition des statuts -->
    <div class="section">
        <h2 class="section-title">üìä R√©partition des statuts de participation</h2>
        
        <div class="table-container">
            <div class="table-title">üìà Distribution des statuts d'inscription des participants</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Statut</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Nombre</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Pourcentage</th>
                    </tr>
                </thead>
                <tbody>
                    {% set totalStatuts = 0 %}
                    {% for statut in additionalStats.statutsParticipation %}
                        {% set totalStatuts = totalStatuts + statut.count %}
                    {% endfor %}
                    
                    {% for statut in additionalStats.statutsParticipation %}
                    <tr style="background-color: {% if loop.index is even %}#f8f9fa{% else %}#ffffff{% endif %};">
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: left;">{{ statut.statutParticipation|title }}</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">{{ statut.count }}</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">
                            {% set percentage = (statut.count / totalStatuts * 100)|round(1) %}
                            {{ percentage }}%
                            <div class="progress-bar" style="background-color: #e9ecef; height: 8px; border-radius: 4px; margin-top: 5px;">
                                <div class="progress-fill {% if statut.statutParticipation == 'accept√©' %}excellent{% elseif statut.statutParticipation == 'en attente' %}good{% else %}poor{% endif %}" style="width: {{ percentage }}%; height: 100%; border-radius: 4px; background-color: {% if statut.statutParticipation == 'accept√©' %}#28a745{% elseif statut.statutParticipation == 'en attente' %}#ffc107{% else %}#dc3545{% endif %};"></div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Section 5: Formations avec participation -->
    <div class="section">
        <h2 class="section-title">üìö D√©tail des formations</h2>
        
        <div class="table-container">
            <div class="table-title">üìã Liste compl√®te des formations avec taux de participation d√©taill√©</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Formation</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Date</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Dur√©e</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Participants</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Taux</th>
                    </tr>
                </thead>
                <tbody>
                    {% for formation in formationsAvecParticipation %}
                    <tr style="background-color: {% if loop.index is even %}#f8f9fa{% else %}#ffffff{% endif %};">
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: left;">{{ formation.sujet }}</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">{{ formation.dateDebut ? formation.dateDebut|date('d/m/Y') : 'Non d√©finie' }}</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">{{ formation.duree }} jour(s)</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">{{ formation.participantsValides }}/{{ formation.totalParticipants }}</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">
                            {{ formation.tauxParticipation }}%
                            <div class="progress-bar" style="background-color: #e9ecef; height: 8px; border-radius: 4px; margin-top: 5px;">
                                <div class="progress-fill {% if formation.tauxParticipation >= 70 %}excellent{% elseif formation.tauxParticipation >= 40 %}good{% else %}poor{% endif %}" style="width: {{ formation.tauxParticipation }}%; height: 100%; border-radius: 4px; background-color: {% if formation.tauxParticipation >= 70 %}#28a745{% elseif formation.tauxParticipation >= 40 %}#ffc107{% else %}#dc3545{% endif %};"></div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Section 6: Statistiques par Responsable -->
    <div class="section">
        <h2 class="section-title">Statistiques par Responsable</h2>
        
        <div class="table-container">
            <div class="table-title">D√©tail des performances de chaque responsable</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Responsable</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Formations</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Sessions</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Participants</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Accept√©s</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Taux</th>
                        <th style="background-color: #007bff; color: white; font-weight: bold; text-align: center; padding: 12px; border: 2px solid #0056b3; font-size: 14px;">Jours Formation</th>
                    </tr>
                </thead>
                <tbody>
                    {% for responsable in statsParResponsable %}
                    <tr style="background-color: {% if loop.index is even %}#f8f9fa{% else %}#ffffff{% endif %};">
                        <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; text-align: left;"><strong>{{ responsable.prenom }} {{ responsable.nom }}</strong></td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">{{ responsable.stats.totalFormations }}</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">{{ responsable.stats.totalSessions }}</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">{{ responsable.stats.totalParticipants }}</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">{{ responsable.stats.participantsValides }}</td>
                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">
                            {{ responsable.stats.tauxParticipation }}%
                            <div class="progress-bar" style="background-color: #e9ecef; height: 8px; border-radius: 4px; margin-top: 5px;">
                                <div class="progress-fill {% if responsable.stats.tauxParticipation >= 70 %}excellent{% elseif responsable.stats.tauxParticipation >= 40 %}good{% else %}poor{% endif %}" style="width: {{ responsable.stats.tauxParticipation }}%; height: 100%; border-radius: 4px; background-color: {% if responsable.stats.tauxParticipation >= 70 %}#28a745{% elseif responsable.stats.tauxParticipation >= 40 %}#ffc107{% else %}#dc3545{% endif %};"></div>
                            </div>
                        </td>
                                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: left;">{{ responsable.stats.joursFormation }} jour(s)</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pied de page -->
    <div class="footer">
        <p><strong>Dashboard des Formations</strong> - Rapport g√©n√©r√© automatiquement</p>
        <p>Utilisateur : {{ user.prenom }} {{ user.nom }} | {{ user.email }}</p>
        <p>¬© {{ "now"|date("Y") }} - Syst√®me de gestion des formations</p>
    </div>


</body>
</html>
